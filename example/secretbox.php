<?php

include "../autoload.php";

$key = FieldElement::fromArray(array(
 0x1b,0x27,0x55,0x64,0x73,0xe9,0x85,0xd4
,0x62,0xcd,0x51,0x19,0x7a,0x9a,0x46,0xc7
,0x60,0x09,0x54,0x9e,0xac,0x64,0x74,0xf2
,0x06,0xc4,0xee,0x08,0x44,0xf6,0x83,0x89
));

$nonce = FieldElement::fromArray(array(
 0x69,0x69,0x6e,0xe9,0x55,0xb6,0x2b,0x73
,0xcd,0x62,0xbd,0xa8,0x75,0xfc,0x73,0xd6
,0x82,0x19,0xe0,0x03,0x6b,0x7a,0x0b,0x37
));

// API requires first 32 bytes to be 0
$msg = FieldElement::fromArray(array(
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x54,0x68,0x65,0x20,0x4e,0x61,0x63,0x6c,
0x3a,0x3a,0x63,0x72,0x79,0x70,0x74,0x6f,
0x5f,0x73,0x65,0x63,0x72,0x65,0x74,0x62,
0x6f,0x78,0x28,0x29,0x20,0x66,0x75,0x6e,
0x63,0x74,0x69,0x6f,0x6e,0x20,0x65,0x6e,
0x63,0x72,0x79,0x70,0x74,0x73,0x20,0x61,
0x6e,0x64,0x20,0x61,0x75,0x74,0x68,0x65,
0x6e,0x74,0x69,0x63,0x61,0x74,0x65,0x73,
0x20,0x61,0x20,0x6d,0x65,0x73,0x73,0x61,
0x67,0x65,0x20,0x75,0x73,0x69,0x6e,0x67,
0x20,0x73,0x65,0x63,0x72,0x65,0x74,0x20,
0x6b,0x65,0x79,0x20,0x61,0x6e,0x64,0x20,
0x61,0x20,0x6e,0x6f,0x6e,0x63,0x65,0x2e
));

$len = count($msg);

$chipertext = Salt::instance()->crypto_secretbox($msg, $len, $nonce, $key);

$plaintext = Salt::instance()->crypto_secretbox_open($chipertext, $len, $nonce, $key);

echo $plaintext->toString();
printf("\n");
